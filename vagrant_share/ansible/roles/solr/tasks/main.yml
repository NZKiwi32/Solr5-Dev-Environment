---
- name: creating vars to Solr URL and file
  set_fact:
    solr_file: "solr-{{ solr_version }}.tgz"
    solr_url: "{{ solr_path }}/{{ solr_version }}/solr-{{ solr_version }}.tgz"

- name: get solr
  get_url: url={{ solr_url }} dest={{ solr_tgz }}

- name: unzip solr
  unarchive: src={{ solr_tgz }} dest={{ solr_home_location }}/ copy=no

# - name: delete solr folder if exists
#   file: path={{ solr_home_location }}/solr state=absent

# - name: create solr user
#   user: name={{solr_user}} home={{ solr_home_location }}/solr shell=/sbin/false state=present

# - name: chown solr user
#   file: path={{ solr_home_location }}/solr group={{solr_user}} owner={{solr_user}} recurse=yes

- name: Install solr
  command: creates=/etc/init.d/solr {{ solr_home_location }}/solr-{{ solr_version }}/bin/install_solr_service.sh {{ solr_tgz }} -d /var/solr/ -p {{ solr_port }} -s solr -u {{ solr_user }}


- name: Start the Solr service
  service: name=solr state=restarted
  sudo: True
